# ⏰ Example: Work Guarantees with Deadlines

> [!WARNING]
> This example was generated by Claude AI. I haven't reviewed it fully but took a glance at it and it looks mostly right.

This example demonstrates how to guarantee that work is completed within a specific number of frames or time window, even if it would exceed the normal budget.

## Overview

Sometimes you have work that **must** be done within a certain timeframe, regardless of budget constraints. GWB provides `MaxDelay` and `MaxNumSkippedFrames` options to handle these scenarios.

## C++ Implementation

### Time-Based Guarantees (MaxDelay)

```cpp
void AMyGameActor::ScheduleCriticalWorkWithTimeGuarantee()
{
    FGWBWorkOptions Options;
    Options.MaxDelay = 0.5f; // Must complete within 500ms of being scheduled
    Options.Priority = 100;  // High priority
    
    UGWBManager::ScheduleWork(
        this,
        "CriticalSystems",
        Options
    ).OnHandleWork([this]() {
        // This work WILL execute within 500ms, even if it breaks the budget
        ProcessCriticalGameplayEvent();
        NotifyPlayersOfImportantEvent();
    });
}
```

### Frame-Based Guarantees (MaxNumSkippedFrames)

```cpp
void AMyGameActor::ScheduleWorkWithFrameGuarantee()
{
    FGWBWorkOptions Options;
    Options.MaxNumSkippedFrames = 10; // Must execute within 10 frames
    Options.Priority = 75;
    
    UGWBManager::ScheduleWork(
        this,
        "Gameplay", 
        Options
    ).OnHandleWork([this]() {
        // This will execute within 10 frames, budget permitting
        // If 10 frames pass, it will execute even if budget is exceeded
        UpdatePlayerStatistics();
    });
}
```

### Combined Guarantees

```cpp
void AMyGameActor::ScheduleWorkWithCombinedGuarantees()
{
    FGWBWorkOptions Options;
    Options.MaxDelay = 1.0f;              // Max 1 second delay
    Options.MaxNumSkippedFrames = 30;     // Max 30 frames (at 60fps = 500ms)
    Options.Priority = 90;
    
    // Whichever limit is hit first will trigger execution
    UGWBManager::ScheduleWork(
        this,
        "Gameplay",
        Options  
    ).OnHandleWork([this]() {
        // Will execute when EITHER 1 second OR 30 frames have passed
        ProcessTimeoutEvent();
    });
}
```

## Real-World Use Cases

### Player Death Processing

```cpp
void APlayerCharacter::OnPlayerDeath()
{
    FGWBWorkOptions DeathOptions;
    DeathOptions.MaxDelay = 0.1f;        // Death must be processed within 100ms
    DeathOptions.MaxNumSkippedFrames = 6; // Or within 6 frames (at 60fps)
    DeathOptions.Priority = 150;         // Highest priority
    
    UGWBManager::ScheduleWork(
        this,
        "CriticalSystems",
        DeathOptions
    ).OnHandleWork([this]() {
        // Critical death processing that cannot be delayed
        StopAllPlayerActions();
        TriggerDeathAnimation();
        UpdatePlayerState();
        SavePlayerProgress();
    });
}
```

### Level Transition Guarantee

```cpp
void ALevelManager::InitiateLevelTransition()
{
    FGWBWorkOptions TransitionOptions;
    TransitionOptions.MaxDelay = 2.0f;    // Level must load within 2 seconds
    TransitionOptions.Priority = 200;     // Absolute highest priority
    
    UGWBManager::ScheduleWork(
        this,
        "CriticalSystems",
        TransitionOptions
    ).OnHandleWork([this]() {
        // This will execute within 2 seconds, even if it causes frame drops
        LoadNextLevel();
        InitializeNewLevelSystems();
    });
}
```

## INI Configuration for Work Groups

You can also set default guarantees at the work group level:

```ini
[/Script/GWBRuntime.GWBManager]
; Critical systems with built-in guarantees
+WorkGroupDefinitions=(Id="CriticalSystems",Priority=100,MaxFrameBudget=0.002,MaxWorkUnitsPerFrame=5,MaxNumSkippedFrames=5,SkipPriorityDelta=50)

; Regular gameplay with frame guarantees
+WorkGroupDefinitions=(Id="Gameplay",Priority=50,MaxFrameBudget=0.003,MaxWorkUnitsPerFrame=10,MaxNumSkippedFrames=30)
```

## How Guarantees Work

### Time-Based (MaxDelay)
1. Work is scheduled with a timestamp
2. System tracks how long work has been waiting
3. When `MaxDelay` time passes, work is **force executed** regardless of budget
4. Can cause frame spikes but ensures timely execution

### Frame-Based (MaxNumSkippedFrames)  
1. System counts how many frames work has been skipped
2. When `MaxNumSkippedFrames` is reached, work is **force executed**
3. More predictable than time-based but less precise timing

## Monitoring and Debugging

### Console Commands

```console
gwb.enabled 1
stat GameWorkBalancer

// Force disable guarantees for testing
gwb.budget.frame -1    // Infinite budget (no forced execution)
```

## Best Practices

1. **Use Sparingly**: Guarantees can cause frame spikes - only use for truly critical work

2. **Set Reasonable Deadlines**: Don't set guarantees too short, allow normal budget processing when possible

3. **Monitor Performance**: Watch for forced executions that cause frame drops

4. **Combine with Priority**: Use high priority with guarantees for best results  

5. **Test Edge Cases**: Verify behavior when many guaranteed work units hit deadlines simultaneously

This guarantee system ensures that critical gameplay events always execute within acceptable timeframes, providing a safety net while maintaining the benefits of frame budget management.